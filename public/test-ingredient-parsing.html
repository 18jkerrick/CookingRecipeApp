<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ingredient Parsing Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .expected, .actual {
            background: white;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
        }
        .actual {
            border-left-color: #28a745;
        }
        .mismatch {
            border-left-color: #dc3545;
            background: #fff5f5;
        }
        .ingredient {
            font-family: 'SF Mono', Monaco, monospace;
            padding: 2px 4px;
            background: #f1f3f4;
            border-radius: 3px;
            margin: 2px 0;
            display: block;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        .stat {
            background: white;
            padding: 15px;
            border-radius: 8px;
            flex: 1;
            text-align: center;
        }
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .loading {
            color: #6c757d;
            font-style: italic;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>üß™ Ingredient Parsing Test</h1>
    <p>This page tests the ingredient parsing for the challenging Butter Chicken recipe to ensure consistent, high-quality output.</p>

    <div class="container">
        <h2>Test Configuration</h2>
        <p><strong>URL:</strong> https://www.indianhealthyrecipes.com/butter-chicken/</p>
        <p><strong>Expected Ingredients:</strong> 32</p>
        <p><strong>Test Focus:</strong> Unicode fractions, ranges, parentheses cleanup, lowercase normalization</p>
        
        <button id="runTest" onclick="runTest()">Run Test</button>
        <button id="copyExpected" onclick="copyExpected()">Copy Expected Output</button>
        <span id="status"></span>
    </div>

    <div class="stats" id="stats" style="display: none;">
        <div class="stat">
            <div class="stat-value" id="totalCount">0</div>
            <div>Total Ingredients</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="matchCount">0</div>
            <div>Exact Matches</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="successRate">0%</div>
            <div>Success Rate</div>
        </div>
    </div>

    <div id="results"></div>

    <script>
        const expectedIngredients = [
            "¬Ω kg boneless chicken",
            "¬Ω to ¬æ teaspoon kashmiri red chili powder",
            "¬º to ‚Öì teaspoon salt",
            "¬æ to 1 tablespoon lemon juice",
            "‚Öì cup greek yogurt",
            "¬æ tablespoon ginger garlic paste",
            "‚Öõ teaspoon turmeric",
            "¬æ to 1 teaspoon garam masala",
            "¬Ω teaspoon cumin powder",
            "1 teaspoon coriander powder",
            "1 teaspoon kasuri methi",
            "¬æ to 1 tablespoon oil",
            "2 to 3 tablespoons butter",
            "2 inch cinnamon",
            "2 to 4 green cardamoms",
            "2 to 4 cloves",
            "1¬Ω cups onions",
            "600 grams fresh tomatoes",
            "¬æ tablespoon ginger garlic paste",
            "1 to 2 green chilies",
            "28 grams whole raw cashews",
            "¬Ω cup water",
            "1 to 2 teaspoons kashmiri chili powder",
            "1 to 1¬Ω teaspoons garam masala",
            "1 to 1¬Ω teaspoon coriander powder",
            "¬Ω teaspoon cumin powder",
            "¬Ω to ¬æ teaspoon salt",
            "1 teaspoon sugar",
            "¬Ω tablespoon kasuri methi",
            "1¬Ω cups hot water",
            "‚Öì cup heavy cream",
            "2 tablespoons coriander leaves"
        ];

        async function runTest() {
            const button = document.getElementById('runTest');
            const status = document.getElementById('status');
            const results = document.getElementById('results');
            const stats = document.getElementById('stats');

            button.disabled = true;
            status.innerHTML = '<span class="loading">‚è≥ Testing ingredient parsing...</span>';
            results.innerHTML = '';
            stats.style.display = 'none';

            try {
                const response = await fetch('/api/parse-url', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        url: 'https://www.indianhealthyrecipes.com/butter-chicken/',
                        mode: 'full'
                    }),
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                
                if (!result.ingredients || !Array.isArray(result.ingredients)) {
                    throw new Error('No ingredients found in response');
                }

                displayResults(result.ingredients);
                status.innerHTML = '<span class="success">‚úÖ Test completed</span>';

            } catch (error) {
                console.error('Test failed:', error);
                status.innerHTML = `<span class="error">‚ùå Test failed: ${error.message}</span>`;
                results.innerHTML = `<div class="container"><h3>Error</h3><p>${error.message}</p></div>`;
            } finally {
                button.disabled = false;
            }
        }

        function displayResults(actualIngredients) {
            const results = document.getElementById('results');
            const stats = document.getElementById('stats');
            
            let matchCount = 0;
            let html = '';

            // Expected ingredients
            html += '<div class="container expected"><h3>Expected Output (32 ingredients)</h3>';
            expectedIngredients.forEach((ingredient, index) => {
                html += `<div class="ingredient">${index + 1}. ${ingredient}</div>`;
            });
            html += '</div>';

            // Actual ingredients
            html += '<div class="container actual"><h3>Actual Output (' + actualIngredients.length + ' ingredients)</h3>';
            actualIngredients.forEach((ingredient, index) => {
                const expected = expectedIngredients[index];
                const matches = ingredient.trim() === expected;
                if (matches) matchCount++;
                
                const className = matches ? 'ingredient' : 'ingredient mismatch';
                html += `<div class="${className}">${index + 1}. ${ingredient.trim()}</div>`;
            });
            html += '</div>';

            // Mismatches
            const mismatches = [];
            const maxLength = Math.max(expectedIngredients.length, actualIngredients.length);
            for (let i = 0; i < maxLength; i++) {
                const expected = expectedIngredients[i] || '[missing]';
                const actual = (actualIngredients[i] || '[missing]').trim();
                if (expected !== actual) {
                    mismatches.push({ index: i + 1, expected, actual });
                }
            }

            if (mismatches.length > 0) {
                html += '<div class="container mismatch"><h3>Mismatches (' + mismatches.length + ')</h3>';
                mismatches.forEach(mismatch => {
                    html += `<div style="margin: 10px 0; padding: 10px; background: white; border-radius: 4px;">`;
                    html += `<strong>#${mismatch.index}</strong><br>`;
                    html += `<strong>Expected:</strong> <code>${mismatch.expected}</code><br>`;
                    html += `<strong>Actual:</strong> <code>${mismatch.actual}</code>`;
                    html += `</div>`;
                });
                html += '</div>';
            }

            results.innerHTML = html;

            // Update stats
            document.getElementById('totalCount').textContent = actualIngredients.length;
            document.getElementById('matchCount').textContent = matchCount;
            document.getElementById('successRate').textContent = 
                Math.round((matchCount / expectedIngredients.length) * 100) + '%';
            stats.style.display = 'flex';
        }

        function copyExpected() {
            const text = expectedIngredients.join('\n');
            navigator.clipboard.writeText(text).then(() => {
                document.getElementById('status').innerHTML = 
                    '<span class="success">üìã Expected output copied to clipboard</span>';
            });
        }

        // Auto-run test on page load for convenience
        window.addEventListener('load', () => {
            setTimeout(runTest, 1000);
        });
    </script>
</body>
</html>